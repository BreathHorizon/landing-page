<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>灵息AI | BreathAI - 次世代对话入口</title>
  <meta name="description" content="灵息AI - 免费访问高阶模型与开发者API，1元一万积分，体验更轻盈的对话。">
  <link rel="icon" href="/avatar.png" type="image/png" />
  
  <!-- Microsoft Clarity -->
  <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "uxr5iuubxb");
  </script>

  <!-- 引入字体与图标 (国内 CDN 加速) -->
  <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- Google Fonts 国内镜像 (Loli.net) -->
  <link rel="preconnect" href="https://fonts.loli.net">
  <link rel="preconnect" href="https://gstatic.loli.net" crossorigin>
  <link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS (官方源 - Play CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      darkMode: 'class', 
      theme: {
        extend: {
          colors: {
            'breath-bg': '#fffcf7',
            'breath-text': '#2c2420',
            'dark-bg': '#12100f',
            'dark-card': '#1c1917',
            'dark-text': '#e7e5e4',
            'dark-border': '#292524',
            'breath-red': '#c04838',
            'breath-gold': '#d4af37',
            'breath-gray': '#8e847f',
            'cf-orange': '#F38020', // Cloudflare 品牌色
          },
          fontFamily: {
            serif: ['"Noto Serif SC"', 'STKaiti', 'serif'],
            sans: ['"Inter"', 'system-ui', 'sans-serif'],
          },
          boxShadow: {
            'soft': '0 4px 20px -2px rgba(44, 36, 32, 0.06)',
            'hover': '0 10px 25px -5px rgba(192, 72, 56, 0.15)',
            'dark-soft': '0 4px 20px -2px rgba(0, 0, 0, 0.3)',
            'dark-hover': '0 10px 25px -5px rgba(0, 0, 0, 0.5)',
          }
        }
      }
    }
  </script>

  <style>
    body { transition: background-color 0.3s ease, color 0.3s ease; }
    .bg-texture::before {
      content: "";
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none; z-index: -1;
    }
    .fade-in-up { animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    @keyframes toastSlide {
      0% { transform: translate(-50%, 100%); opacity: 0; }
      10% { transform: translate(-50%, -20px); opacity: 1; }
      90% { transform: translate(-50%, -20px); opacity: 1; }
      100% { transform: translate(-50%, 20px); opacity: 0; }
    }
    .toast-anim { animation: toastSlide 3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    .modal-enter { animation: modalIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
  </style>

  <script>
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark')
    } else {
      document.documentElement.classList.remove('dark')
    }
    function toggleTheme() {
      document.documentElement.classList.toggle('dark');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    }
  </script>
</head>
<body class="bg-breath-bg text-breath-text dark:bg-dark-bg dark:text-dark-text min-h-screen flex flex-col font-sans bg-texture selection:bg-breath-red selection:text-white">

  <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
    <div class="absolute -top-[20%] right-0 w-[800px] h-[800px] bg-breath-gold/10 dark:bg-breath-gold/5 rounded-full blur-[100px] opacity-60"></div>
    <div class="absolute -bottom-[20%] left-0 w-[600px] h-[600px] bg-breath-red/5 dark:bg-breath-red/5 rounded-full blur-[80px] opacity-40"></div>
  </div>

  <nav class="w-full max-w-6xl mx-auto px-6 py-6 flex justify-between items-center z-20 fade-in-up relative">
    <div class="flex items-center gap-3 select-none">
      <div class="w-10 h-10 rounded-xl bg-white dark:bg-dark-card border border-stone-200 dark:border-dark-border shadow-sm overflow-hidden p-0.5 transition-colors">
        <img src="/avatar.png" alt="Logo" class="w-full h-full object-cover rounded-lg" onerror="this.src='https://placehold.co/100x100/1c1917/ffffff?text=B'">
      </div>
      <div class="flex flex-col">
        <span class="font-serif font-bold text-xl tracking-wide leading-none text-breath-text dark:text-dark-text">灵息 AI</span>
        <span class="text-[10px] tracking-[0.2em] text-breath-gray font-medium mt-1">BREATHAI</span>
      </div>
    </div>
    
    <div class="flex items-center gap-4 text-xs font-medium">
      <div class="hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/60 dark:bg-white/5 border border-stone-200/60 dark:border-white/10 backdrop-blur-sm">
        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
        <span class="text-stone-500 dark:text-stone-400">ONLINE</span>
      </div>
      <button onclick="toggleTheme()" class="w-8 h-8 flex items-center justify-center rounded-full bg-white/60 dark:bg-white/10 hover:bg-stone-100 dark:hover:bg-white/20 transition-colors border border-transparent dark:border-white/5">
        <i class="fa-regular fa-sun hidden dark:block text-breath-gold"></i>
        <i class="fa-regular fa-moon block dark:hidden text-stone-600"></i>
      </button>
      <span id="clock" class="font-mono text-breath-gray tabular-nums min-w-[50px] text-right hidden sm:block">--:--</span>
    </div>
  </nav>

  <main class="flex-grow w-full max-w-6xl mx-auto px-4 sm:px-6 pb-12 flex flex-col gap-6 z-10 relative">
    
    <!-- 公告 -->
    <div id="notice-banner" class="w-full fade-in-up">
      <div class="bg-amber-50 dark:bg-amber-950/40 border border-amber-200 dark:border-amber-700/40 rounded-xl px-4 py-3 flex items-start sm:items-center gap-3 shadow-sm">
        <i class="fa-solid fa-tower-cell text-amber-500 mt-0.5 sm:mt-0"></i>
        <div class="flex-1 text-sm text-amber-900 dark:text-amber-100/90 leading-relaxed">
          <span class="font-bold mr-1">网络公告：</span>
          <span class="opacity-90">武汉及江苏地区用户如遇主站访问缓慢，请优先点击下方 <span class="font-bold underline decoration-amber-400 decoration-2">开始聊天</span> 并在弹窗中选择 Cloudflare 优选节点。</span>
        </div>
        <button onclick="document.getElementById('notice-banner').style.display='none'" class="text-amber-400 hover:text-amber-600 dark:hover:text-amber-100 p-1">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      <!-- Hero Section -->
      <div class="lg:col-span-8 bg-white dark:bg-dark-card border border-stone-200 dark:border-dark-border rounded-3xl p-8 relative overflow-hidden shadow-soft dark:shadow-dark-soft group hover:shadow-hover transition-all duration-500 fade-in-up delay-100">
        <div class="absolute -right-10 -top-10 w-64 h-64 bg-gradient-to-br from-breath-gold/10 to-transparent rounded-full blur-3xl transition-all duration-700"></div>
        
        <div class="relative z-10 h-full flex flex-col justify-between">
          <div>
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-breath-red/5 dark:bg-breath-red/10 text-breath-red text-xs font-bold mb-6 border border-breath-red/10 dark:border-breath-red/20">
              <i class="fa-solid fa-bolt"></i>
              <span>Claude 4.5 & Uncensored Ready</span>
            </div>
            <h1 class="font-serif text-4xl sm:text-5xl font-bold leading-tight mb-4 text-breath-text dark:text-dark-text">
              让对话<br><span class="bg-clip-text text-transparent bg-gradient-to-r from-breath-red to-orange-600">回归灵动与自由</span>
            </h1>
            <p class="text-breath-gray dark:text-stone-400 max-w-lg leading-relaxed text-sm sm:text-base">
              集成 Claude 4.5、Gemini 3 Pro。体验无拘束的创意协作，无论是严谨的代码编写还是自由的灵感探索。
            </p>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8">
            <button onclick="openLineModal('chat')" class="bg-breath-text dark:bg-white text-white dark:text-black px-5 py-4 rounded-xl flex items-center justify-between group hover:bg-black dark:hover:bg-stone-200 transition-colors relative overflow-hidden text-left">
              <div class="flex flex-col items-start z-10">
                <span class="text-[10px] opacity-60 mb-0.5 tracking-wider">GLOBAL</span>
                <span class="font-bold">开始聊天</span>
              </div>
              <i class="fa-solid fa-arrow-right -rotate-45 group-hover:rotate-0 transition-transform z-10"></i>
              <span class="absolute top-0 right-0 bg-breath-red text-white text-[9px] px-2 py-0.5 rounded-bl-lg font-bold">R18</span>
            </button>

            <a href="https://doc.breathai.top" target="_blank" class="bg-white dark:bg-transparent border border-stone-200 dark:border-white/10 text-breath-text dark:text-dark-text px-5 py-4 rounded-xl flex items-center justify-between hover:border-breath-gold/50 hover:text-breath-gold transition-all">
              <div class="flex flex-col items-start">
                <span class="text-[10px] text-breath-gray mb-0.5 tracking-wider">DOCS</span>
                <span class="font-bold">开发文档</span>
              </div>
              <i class="fa-regular fa-file-code text-breath-gray"></i>
            </a>
          </div>
        </div>
      </div>

      <!-- 充值卡片 -->
      <div class="lg:col-span-4 flex flex-col gap-6 fade-in-up delay-200">
        <button onclick="openLineModal('buy')" class="flex-grow bg-gradient-to-br from-stone-800 to-black dark:from-stone-900 dark:to-black rounded-3xl p-6 text-white text-left relative overflow-hidden group shadow-soft dark:shadow-dark-soft hover:shadow-xl hover:scale-[1.02] transition-all border border-transparent dark:border-white/10">
          <div class="absolute inset-0 bg-gradient-to-r from-transparent via-breath-gold/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000 transform skew-x-12"></div>
          <div class="flex justify-between items-start mb-8">
            <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center backdrop-blur-md border border-white/10">
              <i class="fa-solid fa-crown text-breath-gold"></i>
            </div>
            <span class="bg-breath-gold text-black text-[10px] font-bold px-2 py-1 rounded">HOT</span>
          </div>
          <div class="relative z-10">
            <p class="text-white/50 text-xs font-mono uppercase mb-1">Exchange Rate</p>
            <div class="flex items-baseline gap-2">
              <span class="text-3xl font-bold font-serif text-breath-gold">1 CNY</span>
              <span class="text-white/40">=</span>
              <span class="text-2xl font-bold text-white">10,000</span>
              <span class="text-sm text-white/60">积分</span>
            </div>
            <div class="w-full h-px bg-white/10 my-4"></div>
            <p class="text-white/60 text-xs leading-relaxed">
              支持支付宝/微信支付。API 通用，永不过期。
            </p>
          </div>
          <div class="mt-6 flex items-center text-sm font-medium text-breath-gold group-hover:text-white transition-colors">
            <span>立即购买 / Buy Points</span>
            <i class="fa-solid fa-chevron-right text-xs ml-2 group-hover:translate-x-1 transition-transform"></i>
          </div>
        </button>
      </div>
    </div>

    <!-- 特性 Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 fade-in-up delay-300">
      <div class="bg-white dark:bg-dark-card border border-breath-red/20 dark:border-breath-red/10 rounded-2xl p-6 hover:border-breath-red transition-all relative overflow-hidden">
        <div class="absolute -right-4 -bottom-4 w-32 h-32 bg-breath-red/5 rounded-full blur-2xl"></div>
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 rounded-lg bg-breath-red/10 flex items-center justify-center text-breath-red"><i class="fa-solid fa-mask"></i></div>
          <h3 class="font-serif font-bold text-lg text-breath-text dark:text-dark-text">无拘束成人模式</h3>
          <span class="text-[10px] bg-breath-red text-white px-1.5 py-0.5 rounded ml-auto">UNRESTRICTED</span>
        </div>
        <p class="text-sm text-breath-gray dark:text-stone-400 mb-4 leading-relaxed">
          内置 Gemini, DeepSeek, GLM 等特殊微调版本。已提前破线，解除安全限制，<span class="text-breath-red font-medium">可询问任何问题</span>。
        </p>
        <div class="flex flex-wrap gap-2 text-[10px]">
          <span class="px-2 py-1 rounded bg-stone-100 dark:bg-white/5 border border-stone-200 dark:border-white/5">Jailbroken</span>
          <span class="px-2 py-1 rounded bg-stone-100 dark:bg-white/5 border border-stone-200 dark:border-white/5">NSFW</span>
        </div>
      </div>

      <div class="bg-white dark:bg-dark-card border border-stone-200 dark:border-dark-border rounded-2xl p-6 hover:border-blue-400/50 transition-all">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-500"><i class="fa-solid fa-code"></i></div>
          <h3 class="font-serif font-bold text-lg text-breath-text dark:text-dark-text">开发者生态</h3>
        </div>
        <p class="text-sm text-breath-gray dark:text-stone-400 mb-4 leading-relaxed">
          <span class="text-breath-gold font-bold">超低价格</span> 接入。完全兼容 OpenAI 协议，完美支持 QQ / TG / Discord 机器人生态。
        </p>
        <a href="https://doc.breathai.top" class="text-xs text-blue-500 hover:underline">查看接入文档 &rarr;</a>
      </div>

      <div class="bg-white dark:bg-dark-card border border-stone-200 dark:border-dark-border rounded-2xl p-6 hover:border-breath-gold/50 transition-all">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 rounded-lg bg-orange-50 dark:bg-orange-900/20 flex items-center justify-center text-orange-500"><i class="fa-solid fa-microchip"></i></div>
          <h3 class="font-serif font-bold text-lg text-breath-text dark:text-dark-text">全能模型矩阵</h3>
        </div>
        <p class="text-sm text-breath-gray dark:text-stone-400 mb-3 leading-relaxed">
          聚合全球顶尖算力，无需单独订阅。
        </p>
        <div class="flex flex-wrap gap-2 font-mono text-[10px] uppercase">
          <span class="border border-stone-200 dark:border-stone-700 px-2 py-1 rounded text-stone-500">Claude 4.5</span>
          <span class="border border-stone-200 dark:border-stone-700 px-2 py-1 rounded text-stone-500">GPT-5.2</span>
          <span class="border border-stone-200 dark:border-stone-700 px-2 py-1 rounded text-stone-500">Gemini 3</span>
        </div>
      </div>

      <div class="bg-white dark:bg-dark-card border border-stone-200 dark:border-dark-border rounded-2xl p-6 hover:border-green-500/50 transition-all">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 rounded-lg bg-green-50 dark:bg-green-900/20 flex items-center justify-center text-green-600"><i class="fa-solid fa-cloud"></i></div>
          <h3 class="font-serif font-bold text-lg text-breath-text dark:text-dark-text">全端云同步</h3>
        </div>
        <p class="text-sm text-breath-gray dark:text-stone-400 leading-relaxed">
          基于 Open WebUI 架构，聊天记录实时漫游。无论是手机还是电脑，灵感随时延续。
        </p>
      </div>
    </div>
  </main>

  <footer class="w-full border-t border-stone-200 dark:border-dark-border bg-white/50 dark:bg-black/20 backdrop-blur-sm mt-auto z-10">
    <div class="max-w-6xl mx-auto px-6 py-8 flex flex-col md:flex-row justify-between items-center gap-6 text-xs text-breath-gray">
      <button onclick="copyToClipboard('180522359')" class="flex items-center gap-3 bg-white dark:bg-dark-card border border-stone-200 dark:border-dark-border px-5 py-2.5 rounded-full hover:border-blue-400 transition-all">
        <i class="fa-brands fa-qq text-blue-500 text-lg"></i>
        <div class="flex flex-col items-start"><span class="text-[10px] text-stone-400 leading-none mb-1">JOIN COMMUNITY</span><span class="font-mono font-bold text-breath-text dark:text-dark-text text-sm">180522359</span></div>
      </button>
      <div class="flex flex-col items-center md:items-end gap-2">
        <div class="flex gap-4">
          <a href="/terms.html" class="hover:text-breath-red">用户协议</a>
          <span class="text-stone-300">|</span>
          <a href="https://doc.breathai.top" class="hover:text-breath-text">开发者文档</a>
        </div>
        <p class="opacity-60">© 2026 BreathAI / Yearnstudio. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <div id="toast" class="fixed top-8 left-1/2 -translate-x-1/2 bg-breath-text dark:bg-stone-100 text-white dark:text-black px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 z-50 opacity-0 pointer-events-none transition-opacity">
    <i class="fa-solid fa-circle-check text-green-400"></i><span class="font-medium text-sm">已复制到剪贴板</span>
  </div>

  <!-- 线路选择弹窗 -->
  <div id="line-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="closeLineModal()"></div>
    <div class="relative bg-white dark:bg-dark-card border border-stone-200 dark:border-dark-border w-full max-w-md rounded-2xl shadow-2xl p-6 modal-enter">
      <div class="flex justify-between items-center mb-4">
        <h3 id="modal-title" class="font-serif font-bold text-xl text-breath-text dark:text-dark-text text-left">选择接入线路</h3>
        <button onclick="closeLineModal()" class="w-8 h-8 rounded-full bg-stone-100 dark:bg-white/5 flex items-center justify-center text-stone-500 hover:text-breath-text transition-colors"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <!-- 动态进度 Banner 包含刷新按钮 (增加文字) -->
      <div id="modal-status-banner" class="mb-4 px-4 py-2.5 rounded-lg text-xs font-medium flex items-center justify-between transition-all duration-300 bg-stone-100 text-stone-500 dark:bg-white/5 dark:text-stone-400 border border-stone-200/50 dark:border-white/5">
        <div class="flex items-center gap-2">
            <i id="status-icon" class="fa-solid fa-circle-notch fa-spin"></i>
            <span id="status-text">正在初始化检测...</span>
        </div>
        <button id="refresh-btn" onclick="refreshLatencies()" class="h-7 px-2.5 flex items-center gap-1.5 rounded-md hover:bg-stone-200 dark:hover:bg-white/10 transition-all text-stone-400 hover:text-breath-text dark:hover:text-white border border-transparent hover:border-stone-300 dark:hover:border-white/10" title="重新检测">
            <i class="fa-solid fa-rotate-right text-[10px]"></i>
            <span class="text-[11px] font-bold">刷新</span>
        </button>
      </div>

      <div id="modal-content-area" class="space-y-3 max-h-[60vh] overflow-y-auto no-scrollbar"></div>

      <div class="mt-4 text-center text-[10px] text-stone-400 dark:text-stone-500 opacity-80 border-t border-stone-100 dark:border-white/5 pt-4">
        <p>线路延迟仅供参考，请按需选择线路</p>
      </div>
    </div>
  </div>

  <script>
    const clockEl = document.getElementById('clock');
    function updateClock() {
      const now = new Date();
      if (clockEl) clockEl.textContent = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
    }
    setInterval(updateClock, 1000); updateClock();

    function copyToClipboard(text) {
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(showToast);
      } else {
        const area = document.createElement('textarea'); area.value = text;
        area.style.position='fixed'; area.style.opacity='0'; document.body.appendChild(area);
        area.select(); try { document.execCommand('copy'); showToast(); } catch(e){} document.body.removeChild(area);
      }
    }
    function showToast() { const el = document.getElementById('toast'); el.classList.remove('toast-anim'); void el.offsetWidth; el.classList.add('toast-anim'); }

    const modal = document.getElementById('line-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalArea = document.getElementById('modal-content-area');
    const statusBanner = document.getElementById('modal-status-banner');
    const statusText = document.getElementById('status-text');
    const statusIcon = document.getElementById('status-icon');
    const refreshBtn = document.getElementById('refresh-btn');

    let currentLineType = 'chat'; 

    const configs = {
      chat: {
        title: "选择对话线路",
        routes: [
          { id: 'chat-main', name: '官方主线路', domain: 'ask.ling.rest', icon: 'fa-globe', set: 'fa-solid', color: 'text-breath-text dark:text-white' },
          { id: 'chat-yt', name: '亚太节点', domain: 'ask-yt.ling.rest', icon: 'fa-map-pin', set: 'fa-solid', color: 'text-blue-400' },
          { id: 'chat-us', name: '美国高速节点', domain: 'ask-us.ling.rest', icon: 'fa-bolt', set: 'fa-solid', color: 'text-red-400' },
          { id: 'chat-eo', name: '腾讯 EO 节点', domain: 'ask-eo.ling.rest', icon: 'fa-shield-halved', set: 'fa-solid', color: 'text-blue-600' },
          { id: 'chat-cf-std', name: 'Cloudflare 普通节点', domain: 'ask-cf.ling.rest', icon: 'fa-cloudflare', set: 'fa-brands', color: 'text-cf-orange' },
          { id: 'chat-cf-premium', name: 'Cloudflare 优选节点', domain: 'ask-saas.ling.rest', icon: 'fa-bolt-lightning', set: 'fa-solid', color: 'text-amber-500' }
        ]
      },
      buy: {
        title: "选择购买线路",
        routes: [
          { id: 'buy-main', name: '主购买线路', domain: 'buy.ling.rest', icon: 'fa-credit-card', set: 'fa-solid', color: 'text-green-500' },
          { id: 'buy-cf', name: '备用购买线路', domain: 'buy-cf.ling.rest', icon: 'fa-shield-halved', set: 'fa-solid', color: 'text-blue-500' }
        ]
      }
    };

    function openLineModal(type) {
      currentLineType = type;
      const config = configs[type];
      modalTitle.textContent = config.title;
      
      statusBanner.className = "mb-4 px-4 py-2.5 rounded-lg text-xs font-medium flex items-center justify-between transition-all duration-300 bg-stone-100 text-stone-500 dark:bg-white/5 dark:text-stone-400 border border-stone-200/50 dark:border-white/5";
      statusIcon.className = "fa-solid fa-circle-notch fa-spin";
      statusText.textContent = `正在检测线路速度 0/${config.routes.length}`;
      refreshBtn.style.opacity = "0.4";
      refreshBtn.style.pointerEvents = "none";

      modalArea.innerHTML = config.routes.map(r => `
        <a href="https://${r.domain}" target="_blank" id="route-${r.id}" class="block bg-stone-50 dark:bg-white/5 border border-stone-200 dark:border-white/5 hover:border-breath-text dark:hover:border-white/30 rounded-xl p-4 transition-all duration-200 group relative">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-full bg-white dark:bg-black/40 flex items-center justify-center border border-stone-100 dark:border-white/5">
                        <i class="${r.set} ${r.icon} text-lg ${r.color}"></i>
                    </div>
                    <div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-breath-text dark:text-dark-text text-sm">${r.name}</span>
                            <span id="badge-${r.id}" class="hidden bg-green-500 text-white text-[9px] px-1.5 py-0.5 rounded font-bold">推荐</span>
                        </div>
                        <span class="text-[10px] text-stone-500 font-mono">${r.domain}</span>
                    </div>
                </div>
                <div class="flex flex-col items-end">
                     <span id="ping-${r.id}" class="text-[10px] font-mono text-stone-400"><i class="fa-solid fa-circle-notch fa-spin"></i></span>
                </div>
            </div>
        </a>
      `).join('');
      modal.classList.remove('hidden');
      checkLatencies(config.routes);
    }

    function closeLineModal() { modal.classList.add('hidden'); }

    function refreshLatencies() {
        openLineModal(currentLineType);
    }

    async function checkLatencies(routes) {
        const results = [];
        let completed = 0;

        for (const r of routes) {
            const start = Date.now();
            let latency = -1;
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);
                await fetch(`https://${r.domain}/favicon.ico?t=${start}`, { mode: 'no-cors', signal: controller.signal });
                clearTimeout(timeoutId);
                latency = Date.now() - start;
            } catch (e) { latency = -1; }
            
            completed++;
            statusText.textContent = `正在检测线路速度 ${completed}/${routes.length}`;

            results.push({ ...r, latency });
            const pingEl = document.getElementById(`ping-${r.id}`);
            if (pingEl) {
                if (latency === -1) {
                    pingEl.innerHTML = '<i class="fa-solid fa-circle-xmark"></i> 错误';
                    pingEl.className = 'text-[10px] font-mono font-bold text-red-500';
                } else {
                    pingEl.innerHTML = `${latency}ms`;
                    pingEl.className = `text-[10px] font-mono font-bold ${latency < 200 ? 'text-green-500' : 'text-yellow-500'}`;
                }
            }
        }

        statusText.textContent = "线路检测完毕";
        statusIcon.className = "fa-solid fa-circle-check";
        statusBanner.className = "mb-4 px-4 py-2.5 rounded-lg text-xs font-medium flex items-center justify-between transition-all duration-300 bg-green-500/10 text-green-600 dark:bg-green-500/20 dark:text-green-400 border border-green-500/20";
        
        refreshBtn.style.opacity = "1";
        refreshBtn.style.pointerEvents = "auto";

        const valid = results.filter(r => r.latency !== -1);
        if (valid.length > 0) {
            const best = valid.reduce((p, c) => p.latency < c.latency ? p : c);
            const badge = document.getElementById(`badge-${best.id}`);
            if (badge) badge.classList.remove('hidden');
        }
    }

    document.addEventListener('keydown', e => { if (e.key === "Escape") closeLineModal(); });
  </script>
</body>
</html>
